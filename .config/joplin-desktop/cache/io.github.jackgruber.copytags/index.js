(()=>{"use strict";var t={915:t=>{const e=[];function i(t){return t>=48&&t<=57}const o={};t.exports=function(t,n,a){if("string"!=typeof t)throw new TypeError(`The first argument must be a string. Received type '${typeof t}'`);if("string"!=typeof n)throw new TypeError(`The second argument must be a string. Received type '${typeof n}'`);const r=t.length,l=n.length;let s=0,d=0,u=e,c=0;for(a&&(a.caseInsensitive&&(t=t.toLowerCase(),n=n.toLowerCase()),a.alphabet&&(u=function(t){const e=o[t];if(void 0!==e)return e;const i=[],n=t.split("").reduce(((t,e)=>Math.max(t,e.charCodeAt(0))),0);for(let t=0;t<=n;t++)i.push(-1);for(let e=0;e<t.length;e++)i[t.charCodeAt(e)]=e;return o[t]=i,i}(a.alphabet)));s<r&&d<l;){let e=t.charCodeAt(s),o=n.charCodeAt(d);if(i(e)){if(!i(o))return e-o;let a=s,u=d;for(;48===e&&++a<r;)e=t.charCodeAt(a);for(;48===o&&++u<l;)o=n.charCodeAt(u);a!==u&&0===c&&(c=a-u);let g=a,f=u;for(;g<r&&i(t.charCodeAt(g));)++g;for(;f<l&&i(n.charCodeAt(f));)++f;let p=g-a-f+u;if(0!==p)return p;for(;a<g;)if(p=t.charCodeAt(a++)-n.charCodeAt(u++),0!==p)return p;s=g,d=f}else{if(e!==o)return e<u.length&&o<u.length&&-1!==u[e]&&-1!==u[o]?u[e]-u[o]:e-o;++s,++d}}return s<r?1:d<l?-1:c}},775:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=joplin},200:(t,e)=>{var i,o,n,a,r,l,s,d,u,c;Object.defineProperty(e,"__esModule",{value:!0}),e.ContentScriptType=e.SettingStorage=e.AppType=e.SettingItemSubType=e.SettingItemType=e.ToolbarButtonLocation=e.isContextMenuItemLocation=e.MenuItemLocation=e.ModelType=e.ImportModuleOutputFormat=e.FileSystemItem=void 0,(c=e.FileSystemItem||(e.FileSystemItem={})).File="file",c.Directory="directory",(u=e.ImportModuleOutputFormat||(e.ImportModuleOutputFormat={})).Markdown="md",u.Html="html",(d=e.ModelType||(e.ModelType={}))[d.Note=1]="Note",d[d.Folder=2]="Folder",d[d.Setting=3]="Setting",d[d.Resource=4]="Resource",d[d.Tag=5]="Tag",d[d.NoteTag=6]="NoteTag",d[d.Search=7]="Search",d[d.Alarm=8]="Alarm",d[d.MasterKey=9]="MasterKey",d[d.ItemChange=10]="ItemChange",d[d.NoteResource=11]="NoteResource",d[d.ResourceLocalState=12]="ResourceLocalState",d[d.Revision=13]="Revision",d[d.Migration=14]="Migration",d[d.SmartFilter=15]="SmartFilter",d[d.Command=16]="Command",function(t){t.File="file",t.Edit="edit",t.View="view",t.Note="note",t.Tools="tools",t.Help="help",t.Context="context",t.NoteListContextMenu="noteListContextMenu",t.EditorContextMenu="editorContextMenu",t.FolderContextMenu="folderContextMenu",t.TagContextMenu="tagContextMenu"}(i=e.MenuItemLocation||(e.MenuItemLocation={})),e.isContextMenuItemLocation=function(t){return[i.Context,i.NoteListContextMenu,i.EditorContextMenu,i.FolderContextMenu,i.TagContextMenu].includes(t)},(s=e.ToolbarButtonLocation||(e.ToolbarButtonLocation={})).NoteToolbar="noteToolbar",s.EditorToolbar="editorToolbar",(l=e.SettingItemType||(e.SettingItemType={}))[l.Int=1]="Int",l[l.String=2]="String",l[l.Bool=3]="Bool",l[l.Array=4]="Array",l[l.Object=5]="Object",l[l.Button=6]="Button",(r=e.SettingItemSubType||(e.SettingItemSubType={})).FilePathAndArgs="file_path_and_args",r.FilePath="file_path",r.DirectoryPath="directory_path",(a=e.AppType||(e.AppType={})).Desktop="desktop",a.Mobile="mobile",a.Cli="cli",(n=e.SettingStorage||(e.SettingStorage={}))[n.Database=1]="Database",n[n.File=2]="File",(o=e.ContentScriptType||(e.ContentScriptType={})).MarkdownItPlugin="markdownItPlugin",o.CodeMirrorPlugin="codeMirrorPlugin"},240:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createTagHTML=e.htmlToElem=void 0,e.htmlToElem=function(t){let e=document.createElement("template");return e.innerHTML=t,e.content.firstChild},e.createTagHTML=function(t,e,i){const o=document.createElement("div"),n=document.createElement("input"),a=document.createElement("span"),r=document.createElement("input"),l=document.createElement("label");return o.setAttribute("class","tag"),l.innerHTML=i,n.setAttribute("type","checkbox"),n.setAttribute("tagId",t),n.setAttribute("value",e.toString()),n.classList.add("tagcheckbox"),1==e?n.defaultChecked=!0:2==e&&n.classList.add("indeterminate"),a.setAttribute("class","checkmark"),r.setAttribute("type","hidden"),r.setAttribute("name",t),r.setAttribute("value",e.toString()),o.appendChild(n),o.appendChild(a),o.appendChild(l),o.appendChild(r),o.outerHTML}},607:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,a){function r(t){try{s(o.next(t))}catch(t){a(t)}}function l(t){try{s(o.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}s((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(775),a=i(200),r=i(463);n.default.plugins.register({onStart:function(){return o(this,void 0,void 0,(function*(){console.info("Tagging plugin started"),yield n.default.commands.register({name:"CopyAllTags",label:"Copy all tags",enabledCondition:"noteListHasNotes",execute:()=>o(this,void 0,void 0,(function*(){return r.tagging.copyAllTags()}))}),yield n.default.views.menuItems.create("myMenuItemToolsCopyAllTags","CopyAllTags",a.MenuItemLocation.Tools),yield n.default.views.menuItems.create("contextMenuItemCopyAllTags","CopyAllTags",a.MenuItemLocation.NoteListContextMenu),yield r.tagging.createDialog(),yield n.default.commands.register({name:"TaggingDialog",label:"Tagging dialog",enabledCondition:"noteListHasNotes",execute:()=>o(this,void 0,void 0,(function*(){const t=yield n.default.workspace.selectedNoteIds();if(t.length>0){const e=yield r.tagging.getTaggingInfo(t),i=yield r.tagging.showTaggingDialog(e);"ok"==i.id&&(yield r.tagging.processTags(t,i.formData.tags,e))}}))}),yield n.default.views.menuItems.create("MenuItemToolsTaggingDialog","TaggingDialog",a.MenuItemLocation.Tools),yield n.default.views.menuItems.create("contextMenuItemTaggingDialog","TaggingDialog",a.MenuItemLocation.NoteListContextMenu)}))}})},463:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,a){function r(t){try{s(o.next(t))}catch(t){a(t)}}function l(t){try{s(o.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}s((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.tagging=e.tagDialog=void 0;const n=i(775),a=i(915),r=i(240);!function(t){function i(t,e){return o(this,void 0,void 0,(function*(){return yield n.default.data.get(["search"],{query:t,type:"tag",fields:"id,title",limit:e,sort:"title ASC"})}))}function l(t,e){return o(this,void 0,void 0,(function*(){const o=10;let n=[];t=t.trim();let r=yield i(t,o+e.length);for(const t of r.items)if(-1===e.indexOf(t.id)&&n.push({id:t.id,title:t.title}),n.length==o)break;r=yield i(t+"*",o+e.length);for(const t of r.items)if(-1===n.map((t=>t.title)).indexOf(t.title)&&-1===e.indexOf(t.id)&&n.push({id:t.id,title:t.title}),n.length==o)break;if(n.length<o){r=yield i("*"+t+"*",o+e.length);for(const t of r.items)if(-1===n.map((t=>t.title)).indexOf(t.title)&&-1===e.indexOf(t.id)&&n.push({id:t.id,title:t.title}),n.length>=o)break}return n.sort(((t,e)=>a(t.title,e.title,{caseInsensitive:!0}))),n}))}t.showTaggingDialog=function(i){return o(this,void 0,void 0,(function*(){const a=[];for(const t in i)if(a.push(yield(0,r.createTagHTML)(t,i[t].status,i[t].title)),40==a.length)break;const l=document.createElement("div");l.setAttribute("id","copytags");const s=document.createElement("div");s.setAttribute("id","autocomplete"),s.setAttribute("class","autocomplete");const d=document.createElement("textarea");d.setAttribute("id","query-input"),d.setAttribute("rows","1"),d.setAttribute("name","addTag"),d.setAttribute("placeholder","Tag search"),s.appendChild(d);const u=document.createElement("form");u.setAttribute("name","tags");const c=document.createElement("div");if(c.setAttribute("id","assignedTags"),c.innerHTML=a.join("\n"),u.appendChild(c),l.appendChild(s),l.appendChild(u),40==a.length){const t=document.createElement("div");t.setAttribute("id","tagwarning"),t.innerHTML="Too many tags!",l.appendChild(t)}return yield n.default.views.dialogs.setHtml(e.tagDialog,l.outerHTML),n.default.views.panels.onMessage(e.tagDialog,(e=>o(this,void 0,void 0,(function*(){return t.processDialogMsg(e)})))),yield n.default.views.dialogs.open(e.tagDialog)}))},t.getTaggingInfo=function(t){return o(this,void 0,void 0,(function*(){let e={};for(const a of t){var i=1;do{var o=yield n.default.data.get(["notes",a,"tags"],{fields:"id, title",limit:20,page:i++});for(const t of o.items)void 0===e[t.id]?(e[t.id]={},e[t.id].count=1,e[t.id].title=t.title):e[t.id].count++}while(o.has_more)}for(const i in e)e[i].count==t.length?e[i].status=1:e[i].status=2;return e}))},t.processTags=function(t,e,i){return o(this,void 0,void 0,(function*(){for(var o in e)if("new_"===o.substring(0,4)){if(1==e[o]){const e=o.substring(4),i=yield n.default.data.post(["tags"],null,{title:e});for(var a=0;a<t.length;a++)yield n.default.data.post(["tags",i.id,"notes"],null,{id:t[a]})}}else if(void 0===i[o]||e[o]!=i[o].status)if(0==e[o])for(a=0;a<t.length;a++)yield n.default.data.delete(["tags",o,"notes",t[a]]);else if(1==e[o])for(a=0;a<t.length;a++)yield n.default.data.post(["tags",o,"notes"],null,{id:t[a]})}))},t.processDialogMsg=function(t){return o(this,void 0,void 0,(function*(){let e=null;return"tagSearch"===t.type&&(e={type:"tagResult",result:yield l(t.query,t.exclude)}),e}))},t.searchTag=i,t.getTags=l,t.copyAllTags=function(){return o(this,void 0,void 0,(function*(){var t=yield n.default.workspace.selectedNoteIds();if(t.length>1){const r=yield n.default.data.get(["notes",t[0]],{fields:["id","title"]});if(0==(yield n.default.views.dialogs.showMessageBox(`Copy all tags from ${r.title}?`))){var e=1;do{for(var i=yield n.default.data.get(["notes",t[0],"tags"],{fields:"id",limit:10,page:e++}),o=0;o<i.items.length;o++)for(var a=1;a<t.length;a++)yield n.default.data.post(["tags",i.items[o].id,"notes"],null,{id:t[a]})}while(i.has_more)}}}))},t.createDialog=function(){return o(this,void 0,void 0,(function*(){e.tagDialog=yield n.default.views.dialogs.create("TagDialog"),yield n.default.views.dialogs.addScript(e.tagDialog,"webview.js"),yield n.default.views.dialogs.addScript(e.tagDialog,"webview.css")}))}}(e.tagging||(e.tagging={}))}},e={};!function i(o){var n=e[o];if(void 0!==n)return n.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,i),a.exports}(607)})();