(()=>{"use strict";var e={240:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTagHTML=t.htmlToElem=void 0,t.htmlToElem=function(e){let t=document.createElement("template");return t.innerHTML=e,t.content.firstChild},t.createTagHTML=function(e,t,s){const n=document.createElement("div"),a=document.createElement("input"),c=document.createElement("span"),i=document.createElement("input"),o=document.createElement("label");return n.setAttribute("class","tag"),o.innerHTML=s,a.setAttribute("type","checkbox"),a.setAttribute("tagId",e),a.setAttribute("value",t.toString()),a.classList.add("tagcheckbox"),1==t?a.defaultChecked=!0:2==t&&a.classList.add("indeterminate"),c.setAttribute("class","checkmark"),i.setAttribute("type","hidden"),i.setAttribute("name",e),i.setAttribute("value",t.toString()),n.appendChild(a),n.appendChild(c),n.appendChild(o),n.appendChild(i),n.outerHTML}},425:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(a,c){function i(e){try{r(n.next(e))}catch(e){c(e)}}function o(e){try{r(n.throw(e))}catch(e){c(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}r((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=s(240);new class{debounce(e,t=300){let s;return(...n)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(this,n)}),t)}}constructor(){this.autocompleteCurrentFocus=-1,this.setCheckboxIndeterminate(),this.setOnClickEventTagAllCheckBox(),this.setSearchBoxEvent(),this.storeAllTags(),this.setFocus(),document.addEventListener("click",(e=>{this.removeAutocompleteItems()}))}storeAllTags(){this.allTagsIds=[];const e=document.getElementById("assignedTags").getElementsByTagName("input");for(const t of e)"checkbox"==t.getAttribute("type")&&this.allTagsIds.push(t.getAttribute("tagId"))}setSearchBoxEvent(){const e=document.getElementById("query-input");document.addEventListener("input",this.debounce((function(t){""===e.value.trim()?this.clearSearchField():this.searchTag(e.value)}),250)),e.addEventListener("keydown",(e=>{this.navigateAutocompleteList(e)}))}navigateAutocompleteList(e){let t=document.getElementById("autocomplete-list");if(!t)return;let s=t.getElementsByTagName("div");switch(e.key){case"Up":case"Down":case"ArrowUp":case"ArrowDown":this.autocompleteCurrentFocus="ArrowUp"===e.key||"Up"===e.key?this.autocompleteCurrentFocus-1:this.autocompleteCurrentFocus+1,this.markActive(s);break;case"Enter":e.preventDefault(),-1===this.autocompleteCurrentFocus?s[0].click():s[this.autocompleteCurrentFocus].click()}}removeActive(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}markActive(e){if(!e)return!1;this.removeActive(e),this.autocompleteCurrentFocus>=e.length&&(this.autocompleteCurrentFocus=0),this.autocompleteCurrentFocus<0&&(this.autocompleteCurrentFocus=e.length-1),e[this.autocompleteCurrentFocus].classList.add("autocomplete-active")}setCheckboxIndeterminate(){const e=document.getElementsByClassName("indeterminate");for(let t=0;t<e.length;t++)e[t].indeterminate=!0}toggleTagCheckbox(e){const t=e.target.parentNode.getElementsByClassName("tagcheckbox")[0],s=t.getAttribute("tagId"),n=document.getElementsByName(s)[0];return-1!==t.className.indexOf("indeterminate")?1==t.value?(t.indeterminate=!0,t.checked=!1,t.value=2,n.setAttribute("value","2")):2==t.value?(t.indeterminate=!1,t.checked=!1,t.value=0,n.setAttribute("value","0")):(t.indeterminate=!1,t.checked=!0,t.value=1,n.setAttribute("value","1")):1==t.value?(t.checked=!1,t.value=0,n.setAttribute("value","0")):(t.checked=!0,t.value=1,n.setAttribute("value","1")),!1}setOnClickEventTagAllCheckBox(){const e=document.getElementsByClassName("tag");for(let t=0;t<e.length;t++)this.setOnClickEvenForCheckbox(e[t].getElementsByTagName("input")[0]),this.setOnClickEvenForCheckbox(e[t].getElementsByTagName("label")[0])}setOnClickEvenForCheckbox(e){e.addEventListener("click",(e=>{this.toggleTagCheckbox(e)}))}searchTag(e){return n(this,void 0,void 0,(function*(){this.searchText=e,this.resultMessage=yield webviewApi.postMessage({type:"tagSearch",query:this.searchText,exclude:this.allTagsIds}),this.showTagSearch()}))}showTagSearch(){const e=document.getElementById("autocomplete");let t=!0;if(this.removeAutocompleteItems(),this.autocompleteCurrentFocus=-1,this.resultMessage){const s=document.createElement("div");s.setAttribute("class","autocomplete-items"),s.setAttribute("id","autocomplete-list"),e.appendChild(s);for(const e of this.resultMessage.result){const n=document.createElement("div"),a=this.searchText.trim().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),c=new RegExp("("+a+")","i"),i=e.title.replace(c,"<b>$1</b>");n.setAttribute("tagId",e.id),n.setAttribute("tagTitle",e.title),n.innerHTML=i,n.addEventListener("click",(e=>{this.selectTag(e)})),s.appendChild(n),e.title.toLowerCase()===this.searchText.trim().toLowerCase()&&(t=!1)}const n=this.searchText.trim();if(!0===t&&-1===this.allTagsIds.indexOf("new_"+n)){const e=document.createElement("div");e.setAttribute("tagId","new"),e.setAttribute("tagTitle",n),e.innerHTML="<strong>Create tag:</strong> "+n,e.addEventListener("click",(e=>{this.selectTag(e)})),s.insertBefore(e,s.firstChild)}}}selectTag(e){const t=e.target,s=t.getAttribute("tagId"),n=t.getAttribute("tagTitle");this.clearSearchField(),this.addTag(s,n)}clearSearchField(){this.removeAutocompleteItems(),document.getElementById("query-input").value="",this.searchText=""}removeAutocompleteItems(){const e=document.getElementsByClassName("autocomplete-items");this.autocompleteCurrentFocus=-1;for(const t of e)t.parentNode.removeChild(t)}setFocus(){document.getElementById("query-input").focus()}addTag(e,t){const s=document.getElementById("assignedTags");document.createElement("label").innerHTML=t,"new"==e&&(e="new_"+t),this.allTagsIds.push(e);const n=(0,a.htmlToElem)((0,a.createTagHTML)(e,1,t));s.appendChild(n);const c=s.getElementsByClassName("tag");this.setOnClickEvenForCheckbox(c[c.length-1].getElementsByTagName("input")[0]),this.setOnClickEvenForCheckbox(c[c.length-1].getElementsByTagName("label")[0])}}}},t={};!function s(n){var a=t[n];if(void 0!==a)return a.exports;var c=t[n]={exports:{}};return e[n].call(c.exports,c,c.exports,s),c.exports}(425)})();